<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wall of Wishes: ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <style>
        /* A. Keyframes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÇ‡∏ô‡πâ‡∏ï */
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8) rotate(0deg); }
            100% { opacity: 1; transform: scale(1) rotate(var(--random-rotation, 0deg)); }
        }

        /* B. Keyframes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) */
        @keyframes moveBackground {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        /* CSS Styles */
        body {
            font-family: 'Sarabun', sans-serif;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÑ‡∏î‡πâ */
            background: linear-gradient(135deg, #f0f8ff, #e6e6fa); 
            min-height: 100vh;
            background-size: 200% 200%;
            animation: moveBackground 30s ease infinite;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }
        .header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 3px solid #ffcc80;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #4a148c;
            font-weight: 700;
            font-size: 2.5em;
        }
        .section-title {
            color: #8e24aa;
            font-weight: 600;
            border-left: 5px solid #ffb74d;
            padding-left: 10px;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        /* Style for Wishes from Everyone */
        .wishes-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        .wish-card {
            background-color: #fff9c4; /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÇ‡∏ô‡πâ‡∏ï */
            padding: 15px;
            border-radius: 5px;
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.1);
            width: calc(50% - 7.5px); /* 2 cards per row on wider screens */
            box-sizing: border-box;
            border: 1px solid #ffecb3;
            transform: rotate(var(--random-rotation)); /* ‡πÉ‡∏ä‡πâ Custom Property */
            animation: popIn 0.5s ease-out forwards;
        }
        .wish-card p {
            font-style: italic;
            color: #555;
            margin-top: 0;
            min-height: 50px; /* ‡πÉ‡∏´‡πâ card ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô */
        }
        .wish-card .meta {
            text-align: right;
            font-size: 0.9em;
            color: #777;
            font-weight: 600;
            display: block;
        }
        
        /* Your Wish Section */
        #your-wish-box {
            background-color: #e1bee7; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô */
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        #your-wish-box img {
            max-width: 100px;
            height: auto;
            border-radius: 50%;
            border: 3px solid #8e24aa;
            margin-right: 15px;
            float: left;
        }
        #your-wish-box p strong {
            color: #4a148c;
        }
        #wish-form textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 10px;
            box-sizing: border-box;
            font-family: 'Sarabun', sans-serif;
        }
        #submit-wish-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        #submit-wish-btn:hover { background-color: #43a047; }
        .login-message {
            text-align: center;
            color: #c62828;
            font-weight: 600;
        }
        
        /* Media Queries for smaller screens */
        @media (max-width: 600px) {
            .wish-card {
                width: 100%;
            }
        }

        /* ----------------------------------- */
        /* Modal CSS (Thank You Modal) */
        /* ----------------------------------- */
        .thank-you-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
        }
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0,0,0,0.6);
            animation: fadeIn 0.4s;
            border-top: 8px solid #8e24aa;
        }
        .modal-img {
            width: 150px;
            height: auto;
            border-radius: 50%;
            margin-bottom: 20px;
            border: 4px solid #fdd835;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .support-btn {
            background-color: #4CAF50; /* Green for support */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            margin-top: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1em;
            transition: background-color 0.3s;
            display: block; 
            width: 100%;
        }
        .support-btn:hover { background-color: #43a047; }
        .close-modal-btn {
            background-color: #e57373; /* Reddish for close */
            margin-top: 10px;
            padding: 8px 20px;
            font-size: 1em;
            border-radius: 20px;
            width: 100%;
        }
        
    </style>
    </head>
<body>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-hand-holding-heart"></i> Wall of Wishes</h1>
            <p style="color: #666;">‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏ñ‡∏∂‡∏á‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞</p>
        </div>

        <h2 class="section-title"><i class="fas fa-scroll"></i> ‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô</h2>
        <p id="all-wishes-status" style="text-align: center; color: #777;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£...</p>
        <div id="wishesContainer" class="wishes-container">
            </div>

        <h2 class="section-title"><i class="fas fa-pen-nib"></i> ‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
        
        <div id="login-message" class="login-message">
            <p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF ‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô...</p>
        </div>

        <div id="your-wish-box" style="display: none;">
            <img id="profile-pic" src="default_profile.png" alt="Profile Picture">
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> <span id="user-name-display">...</span></p>
            <p style="margin-top: 5px;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞! üëá</p>
            <div style="clear: both;"></div>

            <form id="wish-form">
                <textarea id="wish-text" name="wish-text" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏™‡∏∏‡∏î‡∏ã‡∏∂‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." required></textarea>
                <button type="submit" id="submit-wish-btn"><i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£</button>
            </form>
            <p id="your-wish-status" style="margin-top: 15px; font-weight: 600; color: #4a148c;"></p>
        </div>

    </div>
    
    <div id="thankYouModal" class="thank-you-modal" onclick="closeThankYouModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <img class="modal-img" src="‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì.png" alt="‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï">
            <h2 style="color: #4a148c; margin-top: 0;">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≤‡∏Å‡πÉ‡∏à‡∏à‡∏£‡∏¥‡∏á! ü•≥</h2>
            <p style="color: #7b1fa2; font-weight: 600;">‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏ú‡∏°/‡∏â‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞</p>
            <p>‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞</p>
            
            <button onclick="redirectToSupportPage()" class="support-btn">
                üíµ ‡∏°‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏°‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï üí∞
            </button>
            <button onclick="closeThankYouModal(event)" class="close-modal-btn">
                ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
            </button>
        </div>
    </div>
    <script>
        // LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏ä‡πâ ID ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏)
        const liffId = '2008162847-jMMzgOn1';
        let myUserId = '';
        let myName = ''; 
        let myPictureUrl = '';

        // URL ‡∏Ç‡∏≠‡∏á Backend API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏ä‡πâ URL ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏)
        const apiBaseUrl = 'https://website-degree-bn.onrender.com';
        // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏° (‡πÉ‡∏ä‡πâ URL ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏)
        const supportPageUrl = 'https://liff.line.me/2008162847-GV9l2wmz'; 

        // ===================================
        // Modal Logic
        // ===================================

        function openThankYouModal() {
            document.getElementById('thankYouModal').style.display = 'block';
        }

        function closeThankYouModal(event) {
            const modal = document.getElementById('thankYouModal');
            if (event.target === modal || event.target.className.includes('close-modal-btn')) {
                modal.style.display = 'none';
            }
        }

        function redirectToSupportPage() {
            document.getElementById('thankYouModal').style.display = 'none'; 
            window.location.href = supportPageUrl;
        }


        // ===================================
        // LIFF & Initialization Logic
        // ===================================

        async function initializeLiff() {
            try {
                await liff.init({ liffId: liffId });

                if (!liff.isLoggedIn()) {
                    // ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    myUserId = profile.userId;
                    myName = profile.displayName;
                    myPictureUrl = profile.pictureUrl;
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('login-message').style.display = 'none';
                    document.getElementById('your-wish-box').style.display = 'block';
                    document.getElementById('user-name-display').textContent = myName;
                    
                    if (myPictureUrl) {
                        document.getElementById('profile-pic').src = myPictureUrl;
                    }
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('wish-form').addEventListener('submit', handleWishSubmit);
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    loadAllWishes();
                }
            } catch (err) {
                console.error('LIFF Initialization failed:', err);
                document.getElementById('login-message').innerHTML = `<p style="color:red;">‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${err.message}</p>`;
            }
        }
        
        // ===================================
        // Handle Submit Wish
        // ===================================
        async function handleWishSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-wish-btn');
            submitBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
            submitBtn.disabled = true;

            const wishText = document.getElementById('wish-text').value.trim();
            const payload = {
                line_user_id: myUserId,
                host_name: myName,
                wish: wishText,
                picture_url: myPictureUrl || 'default_profile.png'
            };

            try {
                // üö® URL ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Wall of Wishes (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô /api/wishes)
                const response = await fetch(`${apiBaseUrl}/api/wishes`, { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    // üöÄ NEW: ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ alert
                    openThankYouModal(); 
                    document.getElementById('wish-form').reset();
                    document.getElementById('your-wish-status').textContent = '‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!';
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÉ‡∏´‡∏°‡πà
                    loadAllWishes();
                } else {
                    const errorData = await response.json();
                    alert(`‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${errorData.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}`);
                    document.getElementById('your-wish-status').textContent = '‚ùå ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                }
            } catch (error) {
                console.error('Error submitting wish:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                document.getElementById('your-wish-status').textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            } finally {
                submitBtn.textContent = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£';
                submitBtn.disabled = false;
            }
        }

        // ===================================
        // Load All Wishes
        // ===================================
        async function loadAllWishes() {
            const container = document.getElementById('wishesContainer');
            const statusElement = document.getElementById('all-wishes-status');
            container.innerHTML = ''; // Clear previous wishes
            statusElement.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£...';

            try {
                // üö® URL ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Wall of Wishes (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô /api/wishes)
                const response = await fetch(`${apiBaseUrl}/api/wishes`);
                const wishes = await response.json();

                statusElement.textContent = wishes.length > 0 ? '' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÄ‡∏•‡∏¢... ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô!';
                
                wishes.forEach(wish => {
                    const card = document.createElement('div');
                    card.className = 'wish-card';
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á random rotation (-5deg ‡∏ñ‡∏∂‡∏á +5deg)
                    const rotation = (Math.random() * 10 - 5).toFixed(2); 
                    card.style.setProperty('--random-rotation', `${rotation}deg`);

                    card.innerHTML = `
                        <p>"${wish.wish}"</p>
                        <span class="meta">‚Äî ${wish.host_name}</span>
                    `;
                    container.appendChild(card);
                });

            } catch (error) {
                console.error('Error fetching wishes:', error);
                statusElement.textContent = '‚ùå ‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå';
            }
        }


        // ===================================
        // DOM Content Loaded - Start LIFF
        // ===================================
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof liff !== 'undefined') {
                initializeLiff();
            } else {
                // Mockup Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏õ‡∏Å‡∏ï‡∏¥
                document.getElementById('login-message').innerHTML = '<p>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö LIFF SDK ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>';
                myUserId = 'Umockup_line_id_wish_12345';
                myName = 'Mock User (LIFF)';
                myPictureUrl = 'https://i.pravatar.cc/150?u=mock_user';
                
                document.getElementById('login-message').style.display = 'none';
                document.getElementById('your-wish-box').style.display = 'block';
                document.getElementById('user-name-display').textContent = myName;
                document.getElementById('profile-pic').src = myPictureUrl;
                
                document.getElementById('wish-form').addEventListener('submit', handleWishSubmit);
                loadAllWishes(); 
            }
        });
    </script>
</body>
</html>
