<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ğŸ’Œ Wall of Wishes: à¸ªà¹ˆà¸‡à¸„à¸³à¸­à¸§à¸¢à¸à¸£</title>
Â  Â  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  /* A. Keyframes à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¸™à¸´à¹€à¸¡à¸Šà¸±à¸™à¸›à¸£à¸²à¸à¸à¸‚à¸­à¸‡à¸à¸£à¸°à¸”à¸²à¸©à¹‚à¸™à¹‰à¸• */
Â  Â  Â  Â  @keyframes popIn {
Â  Â  Â  Â  Â  Â  0% { opacity: 0; transform: scale(0.8) rotate(0deg); }
Â  Â  Â  Â  Â  Â  100% { opacity: 1; transform: scale(1) rotate(var(--random-rotation, 0deg)); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* B. Keyframes à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡ */
Â  Â  Â  Â  @keyframes moveBackground {
Â  Â  Â  Â  Â  Â  0% { background-position: 0% 0%; }
Â  Â  Â  Â  Â  Â  50% { background-position: 100% 100%; }
Â  Â  Â  Â  Â  Â  100% { background-position: 0% 0%; }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* CSS Styles */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Sarabun', sans-serif;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  Â  Â  background: linear-gradient(-45deg, #f7f9fc, #f0f4f8, #e0e7f1);
Â  Â  Â  Â  Â  Â  background-size: 400% 400%;
Â  Â  Â  Â  Â  Â  animation: moveBackground 30s ease infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 800px;
Â  Â  Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  position: relative; /* à¸ªà¸³à¸«à¸£à¸±à¸šà¸‹à¹‰à¸­à¸™ Modal */
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #4a148c;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid #ffd54f;
Â  Â  Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  Â  }
Â  Â  Â  Â  h2 {
Â  Â  Â  Â  Â  Â  color: #7b1fa2;
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* LIFF Profile Display */
Â  Â  Â  Â  #profile-info-display {
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  background-color: #f3e5f5;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #profile-picture {
Â  Â  Â  Â  Â  Â  width: 50px;
Â  Â  Â  Â  Â  Â  height: 50px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  margin-right: 15px;
Â  Â  Â  Â  Â  Â  border: 2px solid #7b1fa2;
Â  Â  Â  Â  }
Â  Â  Â  Â  #profile-name {
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  color: #4a148c;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* FORM SECTION */
Â  Â  Â  Â  #blessing-form {
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid #e0e0e0;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  transition: opacity 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: #4a148c;
Â  Â  Â  Â  }
Â  Â  Â  Â  input[type="text"], textarea {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  font-family: 'Sarabun', sans-serif;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  }
Â  Â  Â  Â  textarea { resize: vertical; height: 120px; }
Â  Â  Â  Â  button {
Â  Â  Â  Â  Â  Â  background-color: #4a148c;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  Â  Â  margin-right: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  button:hover { background-color: #7b1fa2; }
Â  Â  Â  Â  #delete-btn { background-color: #e57373; }
Â  Â  Â  Â  #delete-btn:hover { background-color: #d32f2f; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* WALL OF WISHES SECTION (GALLERY) */
Â  Â  Â  Â  #wishes-display {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 30px 20px;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  transition: opacity 0.3s; /* à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸ˆà¸²à¸‡à¸¥à¸‡à¹€à¸¡à¸·à¹ˆà¸­ Modal à¹à¸ªà¸”à¸‡ */
Â  Â  Â  Â  }
Â  Â  Â  Â  .wish-card {
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  transition: transform 0.2s, box-shadow 0.2s;
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  animation: popIn 0.5s ease-out forwards;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
Â  Â  Â  Â  }
Â  Â  Â  Â  .wish-card:hover {
Â  Â  Â  Â  Â  Â  transform: scale(1.03) translateY(-3px) rotate(var(--random-rotation));
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
Â  Â  Â  Â  }
Â  Â  Â  Â  .wish-card p {
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  Â  Â  Â  text-shadow: 0.5px 0.5px 0.5px rgba(0, 0, 0, 0.1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .wish-card .author {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  Â  Â  font-style: normal;
Â  Â  Â  Â  Â  Â  color: #4a148c;Â 
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  font-size: 15px;
Â  Â  Â  Â  Â  Â  border-top: 1px dashed #cccccc;
Â  Â  Â  Â  Â  Â  padding-top: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .liff-info {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  background-color: #ffe0b2;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  color: #e65100;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  #login-message {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* NEW: Thank You Overlay/Modal Style */
Â  Â  Â  Â  #thank-you-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.9); /* à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸—à¸¶à¸šà¸‚à¸¶à¹‰à¸™ */
Â  Â  Â  Â  Â  Â  z-index: 1000;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  display: none; /* à¸‹à¹ˆà¸­à¸™à¹„à¸§à¹‰à¸•à¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ */
Â  Â  Â  Â  }
        .modal-content-box { /* à¹€à¸à¸´à¹ˆà¸¡à¸à¸¥à¹ˆà¸­à¸‡ Modal */
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
Â  Â  Â  Â  #thank-you-overlay h2 {
Â  Â  Â  Â  Â  Â  color: #4a148c;Â 
Â  Â  Â  Â  Â  Â  margin-top: 20px;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.8em;
Â  Â  Â  Â  Â  Â  border-bottom: none;
Â  Â  Â  Â  }
        #support-cta-btn {
            background-color: #4CAF50; /* à¹€à¸‚à¸µà¸¢à¸§ */
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 700;
            margin-top: 20px;
            margin-bottom: 10px;
            width: 100%;
        }
        #support-cta-btn:hover {
            background-color: #43a047;
            transform: scale(1.02);
        }
Â  Â  Â  Â  #thank-you-image {
Â  Â  Â  Â  Â  Â  width: 120px; /* à¸›à¸£à¸±à¸šà¸‚à¸™à¸²à¸”à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸§à¸‡à¸à¸¥à¸¡ */
            height: 120px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;Â 
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  Â  Â  border: 5px solid #ffc107;
Â  Â  Â  Â  }
        /* à¸ªà¹„à¸•à¸¥à¹Œà¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸¸à¹ˆà¸¡à¸›à¸´à¸”à¹ƒà¸™ Modal */
        .close-modal-btn { 
            background: none !important;
            color: #7b1fa2 !important;
            border: none;
            padding: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            display: block;
            width: 100%;
            margin: 0 !important;
        }
        .close-modal-btn:hover {
            text-decoration: underline;
        }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="thank-you-overlay">
        <div class="modal-content-box">
Â  Â  Â  Â      <img id="thank-you-image" src="" alt="Profile Picture">
Â  Â  Â  Â      <h2 style="color: #4a148c; margin-top: 20px; font-size: 1.8em;">à¸‚à¸­à¸šà¸„à¸¸à¸“à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸ªà¸¸à¸”à¸à¸´à¹€à¸¨à¸©! ğŸ™</h2>
Â  Â  Â  Â      <p style="font-size: 1.1em; color: #333; font-weight: 400;">à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¸šà¸™ Wall of Wishes à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§ à¸œà¸¡à¸‹à¸²à¸šà¸‹à¸¶à¹‰à¸‡à¹ƒà¸ˆà¸¡à¸²à¸à¹† à¹€à¸¥à¸¢à¸„à¸£à¸±à¸š/à¸„à¹ˆà¸°!</p>
            <p style="font-weight: 700; color: #4a148c; margin-top: 15px;">à¸«à¸²à¸à¸—à¹ˆà¸²à¸™à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡...</p>
            <button id="support-cta-btn">ğŸ à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™à¹€à¸›à¹‡à¸™à¸à¸´à¹€à¸¨à¸© (à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™)</button>
Â  Â  Â  Â      <button onclick="liff.closeWindow()" class="close-modal-btn">âœ… à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡ LIFF</button>
        </div>
Â  Â  </div>
    
Â  Â  <div class="container">
Â  Â  Â  Â  <h1>ğŸ“ Wall of Wishes ğŸ’Œ</h1>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="liff-info" id="login-message">
Â  Â  Â  Â  Â  Â  à¸à¸³à¸¥à¸±à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š LINE LIFF...
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h2>âœ¨ à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸ˆà¸²à¸à¸—à¸¸à¸à¸—à¹ˆà¸²à¸™</h2>
Â  Â  Â  Â  <div id="wishes-display">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  <hr style="border: 0; border-top: 1px solid #ccc; margin: 30px 0;">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <h2>ğŸ“ à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸‚à¸­à¸‡à¸„à¸¸à¸“</h2>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="profile-info-display">
Â  Â  Â  Â  Â  Â  <img id="profile-picture" src="" alt="Profile Picture">
Â  Â  Â  Â  Â  Â  <span>à¸¥à¹‡à¸­à¸à¸­à¸´à¸™à¸”à¹‰à¸§à¸¢: <span id="profile-name"></span></span>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="blessing-form">
Â  Â  Â  Â  Â  Â  <input type="hidden" id="line-id-hidden" value="">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <label for="name">à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡ (à¸„à¸¸à¸“à¸ªà¸²à¸¡à¸²à¸£à¸–à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­à¹ƒà¸«à¸¡à¹ˆà¹„à¸”à¹‰):</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="name" placeholder="à¹€à¸Šà¹ˆà¸™ à¸à¸µà¹ˆ/à¸™à¹‰à¸­à¸‡/à¹€à¸à¸·à¹ˆà¸­à¸™/à¸„à¸¸à¸“à¸„à¸£à¸¹/à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™" required>

Â  Â  Â  Â  Â  Â  <label for="message">à¸„à¸³à¸­à¸§à¸¢à¸à¸£:</label>
Â  Â  Â  Â  Â  Â  <textarea id="message" placeholder="à¹€à¸‚à¸µà¸¢à¸™à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹à¸ªà¸”à¸‡à¸„à¸§à¸²à¸¡à¸¢à¸´à¸™à¸”à¸µà¹„à¸”à¹‰à¸—à¸µà¹ˆà¸™à¸µà¹ˆ..." required></textarea>

Â  Â  Â  Â  Â  Â  <button onclick="saveBlessing()">à¸šà¸±à¸™à¸—à¸¶à¸/à¹à¸à¹‰à¹„à¸‚</button>
Â  Â  Â  Â  Â  Â  <button id="delete-btn" onclick="deleteBlessing()">à¸¥à¸šà¸„à¸³à¸­à¸§à¸¢à¸à¸£</button>

Â  Â  Â  Â  Â  Â  <p id="form-status" style="margin-top: 15px; font-weight: 600; color: #4a148c;"></p>
Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // ** CONFIGURATION **
Â  Â  Â  Â  const liffId = '2008162847-a7gLZonM';Â 
Â  Â  Â  Â  let myUserId = '';Â 

Â  Â  Â  Â  // ğŸš¨ IMPORTANT: à¸•à¹‰à¸­à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ URL à¸™à¸µà¹‰à¹ƒà¸«à¹‰à¸•à¸£à¸‡à¸à¸±à¸š Backend (FN) à¸‚à¸­à¸‡à¸„à¸¸à¸“
Â  Â  Â  Â  const apiBaseUrl = 'https://wish-website-be.onrender.com';
Â  Â  Â  Â  const apiEndpoint = `${apiBaseUrl}/wishes`;Â 

Â  Â  Â  Â  let allWishes = []; // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸–à¸¹à¸à¸”à¸¶à¸‡à¸¡à¸²à¹€à¸à¹‡à¸šà¸—à¸µà¹ˆà¸™à¸µà¹ˆ

Â  Â  Â  Â  // ğŸŸ¢ NEW CONFIGURATION: à¸ªà¸³à¸«à¸£à¸±à¸šà¸¥à¸´à¸‡à¸à¹Œà¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™à¹à¸¥à¸°à¸£à¸¹à¸›à¸ à¸²à¸
Â  Â  Â  Â  const supportLink = 'https://liff.line.me/2008162847-GV9l2wmz';
Â  Â  Â  Â  // ğŸš¨ à¹ƒà¸Šà¹‰à¸Šà¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œà¸ à¸²à¸à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸§à¹‰à¹ƒà¸™à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™
Â  Â  Â  Â  const thankYouImageUrl = './image_27a912.png';Â 
Â  Â  Â  Â  // ** END CONFIGURATION **

Â  Â  Â  Â  // DOM Elements
Â  Â  Â  Â  const nameInput = document.getElementById('name');
Â  Â  Â  Â  const messageInput = document.getElementById('message');
Â  Â  Â  Â  const statusText = document.getElementById('form-status');
Â  Â  Â  Â  const wishesDisplay = document.getElementById('wishes-display');
Â  Â  Â  Â  const loginMessage = document.getElementById('login-message');
Â  Â  Â  Â  const overlay = document.getElementById('thank-you-overlay');
Â  Â  Â  Â  const formBlock = document.getElementById('blessing-form');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const noteColors = ['#fff59d', '#80cbc4', '#ffab91', '#b39ddb', '#e6ee9c'];Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ===================================
Â  Â  Â  Â  // ğŸš€ LIFF Initialization
Â  Â  Â  Â  // ===================================

Â  Â  Â  Â  async function initializeLiff() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await liff.init({ liffId: liffId });
Â  Â  Â  Â  Â  Â  Â  Â  loginMessage.textContent = 'à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ LIFF à¸ªà¸³à¹€à¸£à¹‡à¸ˆ...';

Â  Â  Â  Â  Â  Â  Â  Â  if (!liff.isLoggedIn()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loginMessage.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹„à¸›à¸«à¸™à¹‰à¸²à¸¥à¹‡à¸­à¸à¸­à¸´à¸™...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  liff.login();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const profile = await liff.getProfile();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myUserId = profile.userId;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-picture').src = profile.pictureUrl || 'https://via.placeholder.com/50';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-name').textContent = profile.displayName;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-info-display').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loginMessage.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await fetchAndLoadWishes(profile.displayName);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('LIFF initialization failed', err);
Â  Â  Â  Â  Â  Â  Â  Â  loginMessage.innerHTML = '<p>âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ LINE LIFF à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹€à¸›à¸´à¸”à¹ƒà¸™à¹à¸­à¸› LINE</p>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ===================================
Â  Â  Â  Â  // ğŸŒ API Call Functions
Â  Â  Â  Â  // ===================================

Â  Â  Â  Â  async function fetchAndLoadWishes(defaultName) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiEndpoint);
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Failed to fetch wishes from API');
Â  Â  Â  Â  Â  Â  Â  Â  allWishes = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  loadAndRenderWishes(defaultName);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching wishes:', error);
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'âš ï¸ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸ˆà¸²à¸à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œà¹„à¸”à¹‰';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  Â  Â  wishesDisplay.innerHTML = '<p style="text-align: center; color: #757575;">à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸ªà¸”à¸‡à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹„à¸”à¹‰à¹ƒà¸™à¸‚à¸“à¸°à¸™à¸µà¹‰</p>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /** à¸šà¸±à¸™à¸—à¸¶à¸/à¹à¸à¹‰à¹„à¸‚à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸œà¹ˆà¸²à¸™ Backend API (POST/PUT) */
Â  Â  Â  Â  async function saveBlessing() {
Â  Â  Â  Â  Â  Â  if (!myUserId) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('à¸à¸£à¸¸à¸“à¸²à¸¥à¹‡à¸­à¸à¸­à¸´à¸™à¸”à¹‰à¸§à¸¢ LINE à¸à¹ˆà¸­à¸™à¸šà¸±à¸™à¸—à¸¶à¸');
Â  Â  Â  Â  Â  Â  Â  Â  liff.login();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const name = nameInput.value.trim();
Â  Â  Â  Â  Â  Â  const message = messageInput.value.trim();

Â  Â  Â  Â  Â  Â  if (!name || !message) {
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'â— à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸–à¹‰à¸§à¸™';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const wishData = {
Â  Â  Â  Â  Â  Â  Â  Â  line_user_id: myUserId,Â 
Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  message: message
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  let currentUserWish = getCurrentUserWish();
Â  Â  Â  Â  Â  Â  let method = currentUserWish ? 'PUT' : 'POST';
Â  Â  Â  Â  Â  Â  let url = currentUserWish ? `${apiEndpoint}/${currentUserWish.id}` : apiEndpoint;Â 

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: method,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(wishData)
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ğŸŸ¢ NEW: à¸ˆà¸±à¸”à¸à¸²à¸£ Action à¸«à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ (à¹à¸ªà¸”à¸‡ Modal à¹€à¸ªà¸¡à¸­)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handlePostSaveAction(method);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json().catch(() => ({ error: 'Unknown Server Error' }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = `â— à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ${errorData.error || 'Server Error'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error submitting data:', error);
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'âŒ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ Backend à¹„à¸”à¹‰';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /** à¸¥à¸šà¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸œà¹ˆà¸²à¸™ Backend API (DELETE) (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡) */
Â  Â  Â  Â  async function deleteBlessing() {
Â  Â  Â  Â  Â  Â  if (!myUserId) return;

Â  Â  Â  Â  Â  Â  let currentUserWish = getCurrentUserWish();

Â  Â  Â  Â  Â  Â  if (currentUserWish) {
Â  Â  Â  Â  Â  Â  Â  Â  if (confirm('à¸¢à¸·à¸™à¸¢à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¸šà¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ? à¸à¸²à¸£à¸¥à¸šà¸™à¸µà¹‰à¸ˆà¸°à¹„à¸¡à¹ˆà¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‡à¸´à¸™à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™à¸«à¸²à¸à¸„à¸¸à¸“à¹€à¸„à¸¢à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${apiEndpoint}/${currentUserWish.id}`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'DELETE'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nameInput.value = document.getElementById('profile-name').textContent || '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageInput.value = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'ğŸ—‘ï¸ à¸¥à¸šà¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const profile = await liff.getProfile();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await fetchAndLoadWishes(profile.displayName);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json().catch(() => ({ error: 'Unknown Server Error' }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = `â— à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸¥à¸š: ${errorData.error || 'Server Error'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error deleting wish:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'âŒ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ Backend à¹„à¸”à¹‰';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'â— à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¸š';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#d32f2f';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ===================================
Â  Â  Â  Â  // ğŸŸ¢ NEW: Post-Save Action Logic (à¹à¸ªà¸”à¸‡ Modal à¸‚à¸­à¸šà¸„à¸¸à¸“à¹€à¸ªà¸¡à¸­)
Â  Â  Â  Â  // ===================================

Â  Â  Â  Â  /** à¹à¸ªà¸”à¸‡ Modal à¸‚à¸­à¸šà¸„à¸¸à¸“à¸à¸£à¹‰à¸­à¸¡à¸£à¸¹à¸›à¸ à¸²à¸ à¹à¸¥à¸°à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸›à¸¸à¹ˆà¸¡ CTA */
Â  Â  Â  Â  function showThankYouModal() {
Â  Â  Â  Â  Â  Â  const image = document.getElementById('thank-you-image');
            const supportBtn = document.getElementById('support-cta-btn'); // à¸›à¸¸à¹ˆà¸¡ CTA
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸¹à¸›à¸ à¸²à¸
Â  Â  Â  Â  Â  Â  image.src = thankYouImageUrl;
            
            // 2. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸›à¸¸à¹ˆà¸¡ CTA à¹ƒà¸«à¹‰ Redirect à¹„à¸›à¸¢à¸±à¸‡à¸¥à¸´à¸‡à¸à¹Œà¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™
            supportBtn.onclick = () => {
                if (liff.isInClient()) {
                    liff.openWindow({
                        url: supportLink,
                        external: false // à¹€à¸›à¸´à¸”à¹ƒà¸™ LIFF Tab à¹€à¸”à¸´à¸¡
                    });
                } else {
                    window.open(supportLink, '_blank');
                }
            };
            
Â  Â  Â  Â  Â  Â  // 3. à¹à¸ªà¸”à¸‡ Modal
Â  Â  Â  Â  Â  Â  overlay.style.display = 'flex'; 

Â  Â  Â  Â  Â  Â  // 4. à¸‹à¹ˆà¸­à¸™/à¸«à¸£à¸µà¹ˆ UI à¸«à¸¥à¸±à¸à¹€à¸à¸·à¹ˆà¸­à¹€à¸™à¹‰à¸™ Modal
Â  Â  Â  Â  Â  Â  formBlock.style.opacity = '0.2';
Â  Â  Â  Â  Â  Â  wishesDisplay.style.opacity = '0.2';
Â  Â  Â  Â  }
        
        /** à¸ˆà¸±à¸”à¸à¸²à¸£ Action à¸«à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ (à¹à¸ªà¸”à¸‡ Modal à¸‚à¸­à¸šà¸„à¸¸à¸“à¹€à¸ªà¸¡à¸­) */
        function handlePostSaveAction(method) {
            // 1. à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸²à¸™à¸°à¹ƒà¸™à¸Ÿà¸­à¸£à¹Œà¸¡
            statusText.textContent = `âœ… ${method === 'POST' ? 'à¸šà¸±à¸™à¸—à¸¶à¸' : 'à¹à¸à¹‰à¹„à¸‚'}à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§`;
            statusText.style.color = '#4a148c';

            // 2. à¹à¸ªà¸”à¸‡ Modal à¸‚à¸­à¸šà¸„à¸¸à¸“ (à¸à¸£à¹‰à¸­à¸¡à¸›à¸¸à¹ˆà¸¡ CTA)
            showThankYouModal();

            // 3. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¹à¸¥à¸°à¹€à¸£à¸™à¹€à¸”à¸­à¸£à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸¥à¸±à¸‡à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ (à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸à¸²à¸£à¹Œà¸”à¸­à¸±à¸›à¹€à¸”à¸•)
            liff.getProfile().then(profile => {
                fetchAndLoadWishes(profile.displayName);
            });
        }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ===================================
Â  Â  Â  Â  // ğŸ¨ UI/Rendering Logic (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ + à¹à¸ªà¸”à¸‡ Amount)
Â  Â  Â  Â  // ===================================

Â  Â  Â  Â  function loadAndRenderWishes(defaultName) {
Â  Â  Â  Â  Â  Â  const userWish = getCurrentUserWish();

Â  Â  Â  Â  Â  Â  // à¸£à¸µà¹€à¸‹à¹‡à¸• opacity à¸à¸£à¸“à¸µà¸›à¸´à¸” Modal
Â  Â  Â  Â  Â  Â  overlay.style.display = 'none';
Â  Â  Â  Â  Â  Â  formBlock.style.opacity = '1';
Â  Â  Â  Â  Â  Â  wishesDisplay.style.opacity = '1';

Â  Â  Â  Â  Â  Â  if (userWish) {
Â  Â  Â  Â  Â  Â  Â  Â  nameInput.value = userWish.name;Â 
Â  Â  Â  Â  Â  Â  Â  Â  messageInput.value = userWish.message;
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'ğŸ’¡ à¸„à¸¸à¸“à¹€à¸„à¸¢à¹€à¸‚à¸µà¸¢à¸™à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹à¸¥à¹‰à¸§ à¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸à¹‰à¹„à¸‚à¹„à¸”à¹‰à¹€à¸¥à¸¢';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#7b1fa2';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  nameInput.value = defaultName || '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  messageInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'âœ¨ à¸„à¸¸à¸“à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸‚à¸µà¸¢à¸™à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹€à¸¥à¸¢ à¹€à¸‚à¸µà¸¢à¸™à¹€à¸¥à¸¢à¸ªà¸´!';
Â  Â  Â  Â  Â  Â  Â  Â  statusText.style.color = '#7b1fa2';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('line-id-hidden').value = myUserId;Â 
Â  Â  Â  Â  Â  Â  renderWishes();
Â  Â  Â  Â  }

Â  Â  Â  Â  function getCurrentUserWish() {
Â  Â  Â  Â  Â  Â  return allWishes.find(wish => wish.line_user_id === myUserId);
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderWishes() {
Â  Â  Â  Â  Â  Â  wishesDisplay.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const currentUserWish = getCurrentUserWish();
Â  Â  Â  Â  Â  Â  let sortedWishes = [...allWishes].filter(wish => wish.line_user_id !== myUserId);
Â  Â  Â  Â  Â  Â  if (currentUserWish) {
Â  Â  Â  Â  Â  Â  Â  Â  sortedWishes.unshift(currentUserWish);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (sortedWishes.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  wishesDisplay.innerHTML = '<p style="text-align: center; color: #757575; font-style: italic;">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸³à¸­à¸§à¸¢à¸à¸£à¹ƒà¸™à¸£à¸°à¸šà¸šà¹€à¸¥à¸¢ à¹€à¸‚à¸µà¸¢à¸™à¹€à¸›à¹‡à¸™à¸„à¸™à¹à¸£à¸à¸ªà¸´!</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  sortedWishes.forEach((wish, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'wish-card';

Â  Â  Â  Â  Â  Â  Â  Â  let colorIndex = index % noteColors.length;
Â  Â  Â  Â  Â  Â  Â  Â  let cardColor = noteColors[colorIndex];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (wish.line_user_id === myUserId) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cardColor = '#a8e6cf';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.style.fontWeight = '600';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  card.style.backgroundColor = cardColor;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let randomRotation = (Math.random() * 6) - 3;Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  card.style.setProperty('--random-rotation', `${randomRotation}deg`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  card.style.animationDelay = `${index * 0.1}s`;Â 

Â  Â  Â  Â  Â  Â  Â  Â  // à¸ªà¹ˆà¸§à¸™à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸„à¹ˆà¸²à¹€à¸‡à¸´à¸™à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™
Â  Â  Â  Â  Â  Â  Â  Â  let amountDisplay = '';
Â  Â  Â  Â  Â  Â  Â  Â  if (wish.amount && Number(wish.amount) > 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formattedAmount = Number(wish.amount).toLocaleString('th-TH');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amountDisplay = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="amount" style="display: block; font-size: 1.2em; font-weight: 700; color: #4CAF50; margin-top: 10px; border-top: 1px dashed #cccccc; padding-top: 8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’° ${formattedAmount} à¸šà¸²à¸—
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>â€œ${wish.message}â€</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${amountDisplay}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="author">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â€” ${wish.name}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${wish.line_user_id === myUserId ? ' (à¸‚à¸­à¸‡à¸„à¸¸à¸“)' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  wishesDisplay.appendChild(card);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ===================================
Â  Â  Â  Â  // â¬‡ï¸ Main Entry Point
Â  Â  Â  Â  // ===================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  if (typeof liff !== 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  initializeLiff();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Mockup Logic à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸šà¹ƒà¸™à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸›à¸à¸•à¸´
Â  Â  Â  Â  Â  Â  Â  Â  loginMessage.innerHTML = '<p>âš ï¸ à¹„à¸¡à¹ˆà¸à¸š LIFF SDK à¸à¸³à¸¥à¸±à¸‡à¸ˆà¸³à¸¥à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š</p>';
Â  Â  Â  Â  Â  Â  Â  Â  myUserId = 'Umockup_line_id_12345';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-info-display').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-picture').src = 'https://via.placeholder.com/50';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-name').textContent = 'Test User (Mock)';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // à¸ªà¸£à¹‰à¸²à¸‡ Mock Data à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸£à¸™à¹€à¸”à¸­à¸£à¹Œ (à¸£à¸§à¸¡ amount)
Â  Â  Â  Â  Â  Â  Â  Â  allWishes = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 1, line_user_id: 'Uother_id_1', name: 'à¸„à¸¸à¸“à¹à¸¡à¹ˆ', message: 'à¸¥à¸¹à¸à¸£à¸±à¸! à¹à¸¡à¹ˆà¸ à¸¹à¸¡à¸´à¹ƒà¸ˆà¹ƒà¸™à¸•à¸±à¸§à¸¥à¸¹à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹€à¸¥à¸¢à¸™à¸° ğŸ’–', amount: 0 },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 2, line_user_id: 'Uother_id_2', name: 'à¹€à¸à¸·à¹ˆà¸­à¸™ A', message: 'à¸¢à¸´à¸™à¸”à¸µà¸”à¹‰à¸§à¸¢à¸™à¸°à¹€à¸à¸·à¹ˆà¸­à¸™! à¹€à¸¥à¸µà¹‰à¸¢à¸‡à¸«à¸™à¹ˆà¸­à¸¢!', amount: 1200 },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 99, line_user_id: myUserId, name: 'Test User (Mock)', message: 'à¸™à¸µà¹ˆà¸„à¸·à¸­à¸„à¸³à¸­à¸§à¸¢à¸à¸£à¸ˆà¸³à¸¥à¸­à¸‡à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸µà¹ˆà¸¥à¹‡à¸­à¸à¸­à¸´à¸™à¸­à¸¢à¸¹à¹ˆ', amount: 500 },Â 
Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  loadAndRenderWishes('Test User (Mock)');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  </script>
</body>

</html>
